
# BTC-MacroECM-Forecaster

Интерактивный сервис на **Streamlit**: задайте сценарии для **SP500 / DXY / OIL**, получите **фан‑чарт прогноза BTC** и рассчитайте **доходность портфеля**.

## Быстрый старт

```bash
# 1) (рекомендуется) создать виртуальное окружение
python -m venv .venv
# Windows:
.venv\Scripts\activate
# macOS / Linux:
source .venv/bin/activate

# 2) Установка зависимостей
pip install -r requirements.txt

# 3) Запуск дэшборда
streamlit run app.py
```
![Uploading image.png…]()

После запуска в браузере откроется UI. По умолчанию данные подтягиваются из Yahoo Finance:
- BTC: `BTC-USD`
- S&P 500: `^SPX`
- DXY: `DX-Y.NYB`
- OIL (брент фьючерс): `BZ=F`

Вы также можете загрузить свои CSV (формат: `date,<COL>`).

## Поля интерфейса

- **Окно оценки (недель):** размер окна для коинтеграции (OLS) и ECM на последнем фрагменте истории.
- **LAGY / LAGX:** лаги ΔBTC и ΔX в ECM.
- **Горизонт (недель):** длина сценарного прогноза.
- **Стохастические пути:** число стохастических траекторий вокруг детерминированных путей факторов.
- **Сценарии по факторам:** для каждого из SP500 / DXY / OIL выберите
  - *Custom годовые темпы* — задайте темп роста/падения в % годовых (первые 52 недели и далее);
  - *Тренд 52 недель* — экстраполяция среднего недельного приращения за последний год;
  - *Возврат к среднему* — линейное схождение к среднему за ~5 лет.
- **Портфель:** доля BTC (остальное считается кэшем с 0%). Доходность и итоговая стоимость считаются по медианной (P50) траектории.

## Как это работает (коротко)

1. **Коинтеграция (OLS, уровни):** `BTC_t ~ const + trend + β_SP*SP500_t + β_DX*DXY_t + β_OIL*OIL_t` на последнем окне.
2. **ECM (ΔBTC):** `ΔBTC_t ~ const + φ*ECT_{t-1} + лаги ΔBTC + лаги ΔX`, где `ECT_t` — ошибка коинтеграции.
3. **Сценарии факторов:** строятся будущие **уровни** факторов (weekly, W-FRI) — либо по заданным вами годовыми темпам (первые 52 недели и далее), либо по тренду/возврату к среднему.
4. **Стохастика:** вокруг детерминированных путей факторов добавляется шум с μ/σ и корреляцией по историческим ΔX (последние 104 недели).
5. **Прогноз BTC:** рекурсивная симуляция через ECM.

## Файлы
- `app.py` — Streamlit UI.
- `scenario_core.py` — функции коинтеграции, ECM и генерации сценариев (взяты и адаптированы из вашего ноутбука).
- `requirements.txt` — зависимости.

## Примечания
- Частота данных — **еженедельная (W‑FRI)** с агрегацией `last`.
- Если Yahoo Finance по какой‑то причине не отдаёт тикер `DX-Y.NYB`, перезапустите/попробуйте альтернативы в коде.
- Для собственных CSV ожидаются колонки: `date,BTC` / `date,SP500` / `date,DXY` / `date,OIL`.
